<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game Space fight</title>
</head>
<body onkeydown = "gameBoard.moveSpaceShip(event)">
<canvas id="myCanvas" width="1200px" height="800px" style="border:1px solid #d3d3d3; background-color: black"></canvas>
<script>
    const GAMEBOARD_WIDTH = 1200;
    const GAMEBOARD_HEIGHT = 800;
    let score = 0;

    const SHIP_HEIGHT = 80;
    const SHIP_WIDTH = 80;
    const SHIP_SPEED = 10;
    const SHIP_STARTX = 500;
    const SHIP_STARTY = 700;
    let spaceShipBombLength = 0;

    const UFO_HEIGHT = 40;
    const UFO_WIDTH = 40;
    const UFO_SPEED = 10;
    const UFO_STARTX = 160;
    const UFO_STARTY = 100;
    let ufo = undefined;
    let totalUfo=[[]];
    let ufoBombList = [];
    let ufoLength = 0;
    let indexUfoCrash = undefined

    const BOMB_HEIGHT = 20;
    const BOMB_WIDTH = 20;
    const BOMB_SPEED = 25;
    class Bomb {
        constructor(bombType,numberBullet,isLaser,speed,x,y,bombdirection) {
            this.bombType = bombType;
            this.numberBullet = numberBullet;
            this.isLaser = isLaser;
            this.speed = BOMB_SPEED;
            this.xPosition = x;
            this.yPosition = y;
            this.width = BOMB_WIDTH;
            this.height = BOMB_HEIGHT;
            this.bombDirection = bombdirection;
        }
        show(){
            let image = new Image();
            let ctx = document.getElementById("myCanvas").getContext('2d')
            let xPosition = this.xPosition;
            let yPosition = this.yPosition;
            image.onload = function () {
                ctx.drawImage(image, xPosition, yPosition, BOMB_WIDTH, BOMB_HEIGHT);
            };
            image.src = './images/' + this.bombType+'.jpeg';
        }
        move(){
            // use for multiple bullet per bomb, maybe for next phase of this project
            // for (let i=0 ; i<this.numberBullet ; i++){
            //     if (this.xPosition > 0 && this.xPosition < GAMEBOARD_WIDTH && this.yPosition > 0 && this.yPosition < GAMEBOARD_HEIGHT) {
            //         this.yPosition -= Math.cos(Math.PI/2 + (-1)^i*i*Math.PI/12)*this.speed*this.bombDirection
            //         this.xPosition += Math.sin(Math.PI/2 + (-1)^i*i*Math.PI/12)*this.speed*this.bombDirection;
            //         this.bulletPosition.push(this.xPosition,this.yPosition);
            //     }
            // }
            if (this.xPosition > - BOMB_WIDTH && this.xPosition < GAMEBOARD_WIDTH && this.yPosition > -BOMB_HEIGHT && this.yPosition < GAMEBOARD_HEIGHT) {
                this.yPosition -= this.speed * this.bombDirection
            }
        }
    }
    class SpaceShip {
        constructor(x, y, bomb) {
            this.xPosition = x;
            this.yPosition = y;
            this.height = SHIP_HEIGHT;
            this.width = SHIP_WIDTH;
            this.speed = SHIP_SPEED;
            this.orientation = 'right';
            this.status = true;
            this.bomb = bomb
            this.bomb.xPosition = this.xPosition + this.width/2 - BOMB_WIDTH/2;
            this.bomb.yPosition = this.yPosition - BOMB_HEIGHT;
            this.cnt = 0
            this.bombList = []
        }
        show(){
            let image = new Image();
            let ctx = document.getElementById("myCanvas").getContext('2d');
            let xPosition = this.xPosition;
            let yPosition = this.yPosition;
            image.onload = function () {
                ctx.drawImage(image, xPosition, yPosition, SHIP_WIDTH, SHIP_HEIGHT);
            };
            image.src ='./images/spaceship2.jpeg'
        }
        move(){
            switch (this.orientation) {
                case 'down':
                    this.yPosition > GAMEBOARD_HEIGHT - SHIP_HEIGHT ? this.yPosition = GAMEBOARD_HEIGHT - SHIP_HEIGHT : this.yPosition = this.yPosition + this.speed;
                    break;
                case 'up':
                    this.yPosition < 0 ? this.yPosition = 0 : this.yPosition = this.yPosition - this.speed;
                    break;
                case 'left':
                    this.xPosition < 0 ? this.xPosition = 0 : this.xPosition = this.xPosition - this.speed;
                    break;
                case 'right':
                    this.xPosition + SHIP_WIDTH > GAMEBOARD_WIDTH ? this.xPosition = GAMEBOARD_WIDTH - SHIP_WIDTH : this.xPosition = this.xPosition + this.speed;
                    break;
            }
        }
        fire(){
            let x = this.xPosition + this.width/2 - BOMB_WIDTH/2;
            let y = this.yPosition - BOMB_HEIGHT;
            this.bombList[this.bombList.length] = new Bomb(this.bomb.bombType,this.bomb.numberBullet,this.bomb.isLaser,this.bomb.speed,x,y,1)
        }
    }
    class Ufo{
        constructor(x,y) {
            this.xPosition = x;
            this.yPosition = y;
            this.height = UFO_HEIGHT;
            this.width = UFO_WIDTH;
            this.speed = UFO_SPEED;
            this.bomb = new Bomb('diamond',1,false,BOMB_SPEED*4)
            this.direction = -1;
            this.bombList = [];
            this.isFire = 0
        }
        show() {
            let image = new Image();
            let ctx = document.getElementById("myCanvas").getContext('2d');
            let xPosition = this.xPosition;
            let yPosition = this.yPosition;
            image.onload = function () {
                ctx.drawImage(image, xPosition, yPosition, UFO_WIDTH, UFO_HEIGHT);
            };
            image.src = './images/ufo3.png'
        }
        move() {
            this.xPosition += this.speed * this.direction
        }
        fire() {
            if (this.isFire === 1) {
                let x = this.xPosition + this.width / 2 - BOMB_WIDTH / 2;
                let y = this.yPosition + this.height - BOMB_HEIGHT;
                ufoBombList[ufoBombList.length] = new Bomb(this.bomb.bombType,this.bomb.numberBullet,this.bomb.isLaser,this.bomb.speed,x,y,-1);
            }
        }
    }

    function createUfo(x,y){
        let ctx = document.getElementById('myCanvas').getContext('2d');
        ufo = new Ufo();
        ufo.xPosition = x;
        ufo.yPosition = y;
        ufo.XSTART = x;
        ufo.YSTART = x;
        ufo.show();
        totalUfo.push(ufo);
    }
    function isCrash(obj,arr){
        for (let i=0 ; i<arr.length ; i++) {
            if ((arr[i].xPosition < obj.xPosition + obj.width)
                && (arr[i].xPosition + arr[i].height > obj.xPosition)
                && (arr[i].yPosition < obj.yPosition + obj.height)
                && (arr[i].yPosition + arr[i].height > obj.yPosition)
            ) {
                return i
            }
        }
        return -1
    }
    function GameBoard(spaceShip) {
        totalUfo = [];
        this.spaceShip = spaceShip;
        this.start = function () {
            this.spaceShip.show();
            for (let i = 0; i < 11; i++) {
                for (let j = 0; j < 5; j++) {
                    createUfo(UFO_STARTX + 80 * i, UFO_STARTY + 80 * j)
                }
            }
        }
        this.render = function () {
            document.getElementById('myCanvas').getContext('2d').clearRect(0, 0, GAMEBOARD_WIDTH, GAMEBOARD_HEIGHT);
            spaceShip.show();
            ufoLength = totalUfo.length;
            if (isCrash(spaceShip, ufoBombList) !== -1 || totalUfo.length === 0) {
                alert("Game End! Your score is " + score);
                clearInterval(playGame)
            } else {
                for (let i = 0; i < ufoLength; i++) {
                    indexUfoCrash = isCrash(totalUfo[i], spaceShip.bombList)
                    if (indexUfoCrash !== -1) {
                        score++;
                        totalUfo.splice(i, 1);
                        spaceShip.bombList.splice(indexUfoCrash, 1);
                        i--;
                    } else {
                        if (totalUfo[i].xPosition < totalUfo[i].XSTART - totalUfo[i].speed * 15 || totalUfo[i].xPosition > totalUfo[i].XSTART + totalUfo[i].speed * 15) {
                            totalUfo[i].direction = -totalUfo[i].direction;
                        }
                        totalUfo[i].move();
                        totalUfo[i].show();
                        totalUfo[i].isFire = Math.floor((Math.random() + 0.005));
                        totalUfo[i].fire();
                    }
                }
                spaceShipBombLength = spaceShip.bombList.length;
                for (let i = 0; i < spaceShipBombLength; i++) {
                    spaceShip.bombList[i].move();
                    spaceShip.bombList[i].show();
                    if (spaceShip.bombList[i].yPosition < 0) {
                        spaceShip.bombList.splice(i, 1)
                    }
                }
                for (let i = 0; i < ufoBombList.length; i++) {
                    ufoBombList[i].move();
                    ufoBombList[i].show();
                    if (ufoBombList[i].yPosition > GAMEBOARD_HEIGHT) {
                        ufoBombList.splice(i, 1)
                    }
                }
            }
        }
        this.moveSpaceShip = function (event) {
            let orientation = '';
            switch (event.key) {
                case ' ':
                    this.spaceShip.fire()
                    break;
                case 'ArrowDown':
                    orientation = 'down';
                    break;
                case 'ArrowUp':
                    orientation = 'up';
                    break;
                case 'ArrowLeft':
                    orientation = 'left';
                    break;
                case 'ArrowRight':
                    orientation = 'right';
                    break;
            }
            if (orientation) {
                if (spaceShip.orientation !== orientation) {
                    spaceShip.orientation = orientation;
                } else {
                    spaceShip.move();
                }
            }
        }
    }
    let bombEgg = new Bomb('egg',1,false,20);
    let spaceShip = new SpaceShip(SHIP_STARTX,SHIP_STARTY,bombEgg);
    let gameBoard = new GameBoard(spaceShip);
    gameBoard.start();
    const playGame = setInterval(gameBoard.render,200);
</script>
</body>
</html>